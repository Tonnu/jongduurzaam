"use strict";function escapeEmailAddress(a){return a?(a=a.toLowerCase(),a=a.replace(/\./g,",")):!1}var app=angular.module("jongduurzaamApp",["ngCookies","ngResource","ngSanitize","ngRoute","firebase"]).constant("FIREBASE_URL","toonverbeek.firebaseio.com").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"PetitionCtrl"}).when("/admin/",{templateUrl:"views/admin.html",controller:"LoginCtrl"}).otherwise({redirectTo:"/"})}]);app.controller("PetitionCtrl",["$scope","$location","$anchorScroll","Petition",function(a,b,c,d){function e(a){for(var b,c,d=a.length;d;b=parseInt(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}a.petition={name:"",email:"",text:""},a.petitions=d.all,a.amountOfPetitions=a.petitions.$getIndex(),a.randomPetitions=[],a.petitions.$on("loaded",function(){var b=Object.keys(a.petitions);b=e(b);for(var c=0,d=!0;d;){var f=a.petitions[b[c]];f?(f.toString().indexOf("function")&&f.toString().indexOf("jongduurzaam")&&a.randomPetitions.push(f),c++):d=!1}}),a.petitions.$on("change",function(){a.amountOfPetitions=a.petitions.$getIndex()}),a.submit=function(){""!==a.petition.name&&""!==a.petition.email&&-1!==a.petition.email.indexOf("@")&&-1!==a.petition.email.indexOf(".")&&a.petition.email.length>=5?(0===a.petition.text.length&&(a.petition.text="Ik steun deze petitie!"),a.petition.followup=document.getElementById("check-email").checked?1:-1,d.create(a.petition).then(function(){a.successsful=!0,a.petition={name:"",email:"",text:""}})):-1===a.petition.email.indexOf("@")||-1===a.petition.email.indexOf(".")||a.petition.email.length<5?($("#alert-placeholder-success").hide(),$("#alert-placeholder-failure").html("Voer een geldig e-mail adres in."),$("#alert-placeholder-failure").show()):($("#alert-placeholder-success").hide(),$("#alert-placeholder-failure").html("Zowel je naam als e-mail adres zijn vereist."),$("#alert-placeholder-failure").show())},a.init=function(){},a.goToElement=function(a,d){b.hash(d),c()}}]),app.factory("Petition",["$firebase","FIREBASE_URL","$rootScope",function(a,b){var c=new Firebase(b+"/jongduurzaam"),d=a(c),e={all:d,create:function(a){for(var b=d.$getIndex(),c=!1,e=0;e<b.length;e++)if(console.log(d[b[e].email]),d[b[e]].email===a.email){console.log("found email key"+a.email),c=!0;break}return c?($("#alert-placeholder-success").hide(),$("#alert-placeholder-failure").html("Dit e-mail adres is al eens gebruikt om een boodschap te versturen."),$("#alert-placeholder-failure").show(),new Error("Dit e-mail adres staat al geregistreerd in ons systeem!")):($("#alert-placeholder-failure").hide(),$("#alert-placeholder-success").show(),d.$add(a))},"delete":function(a){return d.$remove(a)},find:function(a){return d.$child(a)},update:function(){}};return e}]),app.controller("LoginCtrl",["$scope","$location","$firebaseSimpleLogin","FIREBASE_URL",function(a,b,c,d){var e=new Firebase(d+"/jongduurzaam");a.auth=c(e)}]);